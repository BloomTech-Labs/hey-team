{
  (ok = true),
    (access_token =
      'xoxp-154966377728-243206362375-335738147301-c373832eb49d5477f7230b7cb295f514'),
    (scope =
      'identify,bot,incoming-webhook,search:read,identity.basic,identity.email,identity.avatar,identity.team'),
    (user = {
      name: 'David Long',
      id: 'U7562ANB1',
      email: 'davdaarn@live.com',
      image_24:
        'https://avatars.slack-edge.com/2018-02-01/308404605972_a103b07441746f346be9_24.png',
      image_32:
        'https://avatars.slack-edge.com/2018-02-01/308404605972_a103b07441746f346be9_32.png',
      image_48:
        'https://avatars.slack-edge.com/2018-02-01/308404605972_a103b07441746f346be9_48.png',
      image_72:
        'https://avatars.slack-edge.com/2018-02-01/308404605972_a103b07441746f346be9_72.png',
      image_192:
        'https://avatars.slack-edge.com/2018-02-01/308404605972_a103b07441746f346be9_192.png',
      image_512:
        'https://avatars.slack-edge.com/2018-02-01/308404605972_a103b07441746f346be9_512.png',
      image_1024:
        'https://avatars.slack-edge.com/2018-02-01/308404605972_a103b07441746f346be9_1024.png',
    }),
    (team = {
      id: 'T4JUEB3ME',
      name: 'Lambda School Students',
      domain: 'lambdaschoolstudents',
      image_34:
        'https://slack-files2.s3-us-west-2.amazonaws.com/avatars/2018-03-07/325933292993_ef2a40f6df468f38e7b3_34.png',
      image_44:
        'https://slack-files2.s3-us-west-2.amazonaws.com/avatars/2018-03-07/325933292993_ef2a40f6df468f38e7b3_44.png',
      image_68:
        'https://slack-files2.s3-us-west-2.amazonaws.com/avatars/2018-03-07/325933292993_ef2a40f6df468f38e7b3_68.png',
      image_88:
        'https://slack-files2.s3-us-west-2.amazonaws.com/avatars/2018-03-07/325933292993_ef2a40f6df468f38e7b3_88.png',
      image_102:
        'https://slack-files2.s3-us-west-2.amazonaws.com/avatars/2018-03-07/325933292993_ef2a40f6df468f38e7b3_102.png',
      image_132:
        'https://slack-files2.s3-us-west-2.amazonaws.com/avatars/2018-03-07/325933292993_ef2a40f6df468f38e7b3_132.png',
      image_230:
        'https://slack-files2.s3-us-west-2.amazonaws.com/avatars/2018-03-07/325933292993_ef2a40f6df468f38e7b3_230.png',
      image_original:
        'https://slack-files2.s3-us-west-2.amazonaws.com/avatars/2018-03-07/325933292993_ef2a40f6df468f38e7b3_original.png',
    });
}
///////////////////////////////////////////////////////
{
  ok: true,
    (access_token =
      'xoxp-270618182930-333672065634-333966161058-b1a3c96692eec2b397bb3c614572c67f'),
    (scope =
      'identify,bot,commands,incoming-webhook,im:read,search:read,team:read,chat:write:bot,identity.basic,identity.email,identity.avatar,identity.team'),
    (user = {
      name: 'David Long',
      id: 'U9TKS1XJN',
      email: 'davdaarn@live.com',
      image_24:
        'https://secure.gravatar.com/avatar/73a0f5d52e19bb5f6981f125fdfa6bbe.jpg?s=24&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0024-24.png',
      image_32:
        'https://secure.gravatar.com/avatar/73a0f5d52e19bb5f6981f125fdfa6bbe.jpg?s=32&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0024-32.png',
      image_48:
        'https://secure.gravatar.com/avatar/73a0f5d52e19bb5f6981f125fdfa6bbe.jpg?s=48&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0024-48.png',
      image_72:
        'https://secure.gravatar.com/avatar/73a0f5d52e19bb5f6981f125fdfa6bbe.jpg?s=72&d=https%3A%2F%2Fa.slack-edge.com%2F66f9%2Fimg%2Favatars%2Fava_0024-72.png',
      image_192:
        'https://secure.gravatar.com/avatar/73a0f5d52e19bb5f6981f125fdfa6bbe.jpg?s=192&d=https%3A%2F%2Fa.slack-edge.com%2F7fa9%2Fimg%2Favatars%2Fava_0024-192.png',
      image_512:
        'https://secure.gravatar.com/avatar/73a0f5d52e19bb5f6981f125fdfa6bbe.jpg?s=512&d=https%3A%2F%2Fa.slack-edge.com%2F7fa9%2Fimg%2Favatars%2Fava_0024-512.png',
    }),
    (team = {
      id: 'T7YJ65CTC',
      name: '3Dice Job',
      domain: '3dicejob',
      image_34:
        'https://a.slack-edge.com/66f9/img/avatars-teams/ava_0005-34.png',
      image_44:
        'https://a.slack-edge.com/66f9/img/avatars-teams/ava_0005-44.png',
      image_68:
        'https://a.slack-edge.com/66f9/img/avatars-teams/ava_0005-68.png',
      image_88:
        'https://a.slack-edge.com/66f9/img/avatars-teams/ava_0005-88.png',
      image_102:
        'https://a.slack-edge.com/66f9/img/avatars-teams/ava_0005-102.png',
      image_132:
        'https://a.slack-edge.com/66f9/img/avatars-teams/ava_0005-132.png',
      image_230:
        'https://a.slack-edge.com/bfaba/img/avatars-teams/ava_0005-230.png',
      image_default: true,
    });
}
///////////////////////////////////////////////////////
{
  ok: true,
    (access_token =
      'xoxp-154966377728-243206362375-335738147301-c373832eb49d5477f7230b7cb295f514'),
    (scope =
      'identify,bot,incoming-webhook,search:read,identity.basic,identity.email,identity.avatar,identity.team'),
    (user_id = 'U7562ANB1'),
    (team_name = 'Lambda School Students'),
    (team_id = 'T4JUEB3ME'),
    (incoming_webhook = {
      channel: 'labs-heyteam',
      channel_id: 'G9RRETNLQ',
      configuration_url:
        'https://lambdaschoolstudents.slack.com/services/B9XJ6SCK0',
      url:
        'https://hooks.slack.com/services/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',
    }),
    (bot = {
      bot_user_id: 'U9VFGKMJP',
      bot_access_token: 'xoxb-335526667635-qndUF8I2RhivCGA0naMbt7Go',
    });
}
//////////////////////////////////////////////////////
{
  ok: true,
    (access_token =
      'xoxp-270618182930-333672065634-333966161058-b1a3c96692eec2b397bb3c614572c67f'),
    (scope =
      'identify,bot,commands,incoming-webhook,im:read,search:read,team:read,chat:write:bot,identity.basic,identity.email,identity.avatar,identity.team'),
    (user_id = 'U9TKS1XJN'),
    (team_name = '3Dice Job'),
    (team_id = 'T7YJ65CTC'),
    (incoming_webhook = {
      channel: '@davdaarn',
      channel_id: 'D9TP7PBT7',
      configuration_url: 'https://3dicejob.slack.com/services/B9WLHGMNX',
      url:
        'https://hooks.slack.com/services/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',
    }),
    (bot = {
      bot_user_id: 'U9U3H1WNR',
      bot_access_token: 'xoxb-334119064773-U6lf4TG13OrIhJm2IvrX1Uvw',
    });
}

const initiate = async (req, res) => {
  const { a_id, c_id, users } = await req.body;
  const account = await Account.findById(a_id);

  const token = 'xoxb-334119064773-UW39H2oHxVepvxe1DJWXlbmd';
  // const rtm = new RTMClient(token);
  const web = new WebClient(token);
  // get owner id and dm owner response
  // get user and dm
  let questions = [];
  async.each(account.conversations, c => {
    if (c._id.toString() === c_id) {
      questions = c.questions;
    }
  });

  const getit = async position => {
    if (position === users.length) {
      account.save();
      console.log(account.conv_map);
    } else {
      console.log();
      const dm = await web.im.open({ user: users[position] }).then(dm => {
        web.chat
          .postMessage({
            channel: dm.channel.id,
            text: questions[0],
          })
          .then(res => {
            // `res` contains information about the posted message
            console.log('Message sent: ', res.ts);
            account.conv_map.push({
              user_id: users[position],
              c_id,
            });
          })
          .catch(console.error);
        position++;
        getit(position);
      });
    }
    res.send(questions);
  };

  getit(0);
};

///////////////////////////////////////////////////////////////////////////////
conv_map = [
  {
    channel: 'D9TSHMKPD',
  },
  {
    channel: 'TTTTTTTTT',
  },
  {
    channel: 'RRRRRRRRR',
  },
];

///////////////////////////////////////////////////////////////////

const test = async (req, res) => {
  const { a_id, c_id, users } = req.body;
  // return res.send('hey');
  let questions = [];
  const answers = [];
  const token = 'xoxb-334119064773-UW39H2oHxVepvxe1DJWXlbmd';
  const rtm = new RTMClient(token);
  const web = new WebClient(token);
  // get owner id and dm owner response
  // get user and dm
  const dm = await web.im.open({ user: 'U9TKS1XJN' });
  console.log(dm.channel.id);

  const convo = await Account.findById({
    _id: a_id,
  });
  console.log(1);
  rtm.start();
  web.channels
    .list()
    .then(res => {
      // const channel = res.channels.find(c => c.is_member);
      console.log('Channel', 'res');
    })
    .catch(console.error);

  // convo.conversations.forEach(c => {
  // if (schedule) {}
  //   c.participants.forEach(p => {});
  // });
  // rtm.subscribePresence('U9TKS1XJN');
  convo.conversations.forEach(c => {
    console.log(c._id);
    if (c._id.toString() === c_id) {
      questions = c.questions;
    }
  });
  const conversationId = dm.channel.id;
  const queLength = questions.length;
  let currentQuestion = 0;

  rtm.on('message', event => {
    console.log(event);
  });

  // rtm
  //   .sendMessage(questions[currentQuestion], conversationId)
  //   .then(res => {
  //     currentQuestion++;
  //   })
  //   .catch(console.error);

  // rtm.on('message', event => {
  //   // console.log('event', event);
  //   answers.push(event.text);
  //   if (currentQuestion < queLength) {
  //     rtm
  //       .sendMessage(questions[currentQuestion], conversationId)
  //       .then(res => {
  //         // console.log('Message sent: ', res);
  //         currentQuestion++;
  //       })
  //       .catch(console.error);
  //   } else {
  //     rtm.disconnect();

  //     const newConversation = new Conversation({});
  //     const newResponse = new Response({
  //       user: 'test',
  //       questions,
  //       answers,
  //     });

  //     convo.conversations.push(newConversation);
  //     convo.conversations.remove(newConversation);
  //     convo.conversations[0].responses.push({
  //       submittedOn: new Date(),
  //       user: 'String',
  //       avatar: 'String',
  //       questions,
  //       answers,
  //     });

  //     convo.save();

  //     attachments = [];
  //     questions.forEach((q, i) => {
  //       attachments.push({
  //         title: questions[i],
  //         text: answers[i],
  //       });
  //     });
  //     ///////////////////////////////////////

  //     web.chat
  //       .postMessage({
  //         channel: conversationId,
  //         text: "Today's Standup Questionnaire",
  //         attachments,
  //       })
  //       .then(res => {
  //         // `res` contains information about the posted message
  //         console.log('Message sent: ', res.ts);
  //       })
  //       .catch(console.error);

  //     /////////////////////////////////////////
  //   }
  // });
  res.send('heyyyy');
};

// web.chat
//   .postMessage({
//     channel: conversationId,
//     text: "Today's Standup Questionnaire",
//     attachments,
//     attachments: [
//     {
//       fallback: 'Required plain-text summary of the attachment.',
//       color: '#36a64f',
//       author_name: 'Team Lead Name',
//       author_link: 'http://flickr.com/bobby/',
//       author_icon: 'http://flickr.com/icons/bobby.jpg',
//       title: 'Slack API Documentation',
//       title_link: 'https://api.slack.com/',
//       text: 'Optional text that appears within the attachment',
//       fields: [
//         {
//           title: 'Priority',
//           value: 'High',
//           short: false,
//         },
//       ],
//       image_url: 'http://my-website.com/path/to/image.jpg',
//       thumb_url: 'http://example.com/path/to/thumb.png',
//       footer: 'Slack API',
//       footer_icon:
//         'https://platform.slack-edge.com/img/default_application_icon.png',
//       ts: 123456789,
//     },
//     ],
//   })
//   .then(res => {
//     // `res` contains information about the posted message
//     console.log('Message sent: ', res.ts);
//   })
//   .catch(console.error);
